<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Parking - Mapa Interactivo Adaptado</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            text-align: center; 
            background-color: #1a1a1a; 
            color: white;
            margin: 0;
            padding: 20px;
        }

        .map-container {
            position: relative;
            display: inline-block;
            margin: 20px auto;
            border: 4px solid #3498db;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.5);
            background-color: white;
            line-height: 0;
        }

        .map-image {
            display: block;
            max-width: 95vw;
            max-height: 70vh;
            border-radius: 8px;
        }

        /* Estilo general de las plazas */
        .plaza {
            position: absolute;
            width: 32px;
            height: 32px;
            border: 2px solid white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            line-height: 32px;
            text-align: center;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        /* Clase especial para plazas adaptadas */
        .adaptada {
            border: 2px solid #0056b3;
            border-radius: 50%; /* Las hacemos circulares para que destaquen */
        }

        .plaza:hover { transform: scale(1.3); z-index: 100; }

        /* Estados de color */
        .libre { background-color: #2ecc71; box-shadow: 0 0 15px #2ecc71; }
        .ocupado { background-color: #e74c3c; box-shadow: 0 0 15px #e74c3c; }
        .error { background-color: #f1c40f; box-shadow: 0 0 15px #f1c40f; }
        /* Si la adaptada está libre, usamos un azul brillante */
        .adaptada.libre { background-color: #3498db; box-shadow: 0 0 15px #3498db; }

        #info-panel {
            max-width: 450px;
            margin: 20px auto;
            padding: 20px;
            background: #ffffff;
            color: #333;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            display: none;
            border-top: 5px solid #0056b3;
        }
    </style>
</head>
<body>

    <h1>Sistema de Parking Inteligente ♿</h1>
    <p>Las plazas circulares azules son <b>adaptadas para movilidad reducida</b>.</p>

    <div class="map-container">
        <img src="{{ url_for('static', filename='img/logo_parking.png') }}" class="map-image">

        <div id="p2" class="plaza adaptada error" style="top: 15%; left: 85%;" onclick="mostrarInfo('Zona Norte', true)">♿</div>
        <div id="p3" class="plaza error" style="top: 22%; left: 85%;" onclick="mostrarInfo('Zona Norte', false)">2</div>
        
        <div id="p4" class="plaza adaptada error" style="top: 70%; left: 85%;" onclick="mostrarInfo('Zona Sur', true)">♿</div>
        <div id="p5" class="plaza error" style="top: 77%; left: 85%;" onclick="mostrarInfo('Zona Sur', false)">2</div>

        <div id="p6" class="plaza adaptada error" style="top: 45%; left: 45%;" onclick="mostrarInfo('Zona Central', true)">♿</div>
        <div id="p7" class="plaza error" style="top: 52%; left: 45%;" onclick="mostrarInfo('Zona Central', false)">2</div>
    </div>

    <div id="info-panel">
        <h2 id="zona-nombre" style="margin-top:0;">Sector</h2>
        <div id="zona-stats" style="font-size: 1.1em; line-height: 1.6;"></div>
        <button onclick="document.getElementById('info-panel').style.display='none'" style="margin-top:15px; cursor:pointer; padding:8px 15px; background:#0056b3; color:white; border:none; border-radius:5px;">Entendido</button>
    </div>

    <script>
        const CONFIG = {
            "Zona Norte": 45,
            "Zona Sur": 29,
            "Zona Central": 198
        };

        function mostrarInfo(nombreZona, esAdaptada) {
            let ocupadas = 0;
            if (nombreZona === "Zona Norte") {
                if(document.getElementById('p2').classList.contains('ocupado')) ocupadas++;
                if(document.getElementById('p3').classList.contains('ocupado')) ocupadas++;
            } else if (nombreZona === "Zona Sur") {
                if(document.getElementById('p4').classList.contains('ocupado')) ocupadas++;
                if(document.getElementById('p5').classList.contains('ocupado')) ocupadas++;
            } else if (nombreZona === "Zona Central") {
                if(document.getElementById('p6').classList.contains('ocupado')) ocupadas++;
                if(document.getElementById('p7').classList.contains('ocupado')) ocupadas++;
            }

            const disponibles = CONFIG[nombreZona] - ocupadas;
            const panel = document.getElementById('info-panel');
            panel.style.display = 'block';
            
            let avisoPMR = esAdaptada ? "<p style='color:#0056b3; font-weight:bold;'>⚠️ ESTA ES UNA PLAZA ADAPTADA (♿).<br>Uso exclusivo para personas con movilidad reducida.</p>" : "";

            document.getElementById('zona-nombre').innerText = nombreZona;
            document.getElementById('zona-stats').innerHTML = 
                avisoPMR +
                `Capacidad total del sector: <b>${CONFIG[nombreZona]}</b><br>` +
                `Disponibilidad actual: <b style="font-size:1.4em; color:#2ecc71">${disponibles}</b>`;
            
            panel.scrollIntoView({ behavior: 'smooth' });
        }

        function actualizarDatos() {
            fetch('/status')
                .then(response => response.json())
                .then(data => {
                    for (let i = 2; i <= 7; i++) {
                        let id = "p" + i;
                        let element = document.getElementById(id);
                        if (!element) continue;

                        let estado = data[id]; 
                        element.classList.remove('libre', 'ocupado', 'error');

                        if (estado === 1) {
                            element.classList.add('ocupado');
                        } else if (estado === 0) {
                            element.classList.add('libre');
                        } else {
                            element.classList.add('error');
                        }
                    }
                })
                .catch(err => console.error("Error:", err));
        }

        setInterval(actualizarDatos, 2000);
        actualizarDatos();
    </script>
</body>
</html>
