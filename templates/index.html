<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Parking Ociopia - Dashboard</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background-color: #121212; color: white; 
            margin: 0; display: flex; height: 100vh; overflow: hidden;
        }

        /* LADO IZQUIERDO: MAPA */
        .main-layout {
            flex: 1; position: relative; padding: 20px;
            display: flex; align-items: center; justify-content: center;
        }

        .map-container {
            position: relative; border: 3px solid #444; border-radius: 15px;
            background: white; line-height: 0; box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .map-image { max-width: 100%; max-height: 85vh; border-radius: 12px; }

        /* LADO DERECHO: PANEL FIJO */
        .side-panel {
            width: 320px; background-color: #1e1e1e; border-left: 2px solid #333;
            padding: 30px 20px; box-sizing: border-box; display: flex; flex-direction: column;
        }

        /* ESTILO ZONAS INTERACTIVAS */
        .zona-interactiva {
            position: absolute; cursor: pointer; transition: 0.3s;
            background-color: rgba(0, 0, 0, 0.6); border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: space-around;
            padding: 5px; box-sizing: border-box; text-align: center;
        }
        .zona-interactiva:hover { background-color: rgba(0, 0, 0, 0.8); }

        #zona-norte { border: 2px solid #3498db; color: #3498db; }
        #zona-sur { border: 2px solid #e74c3c; color: #e74c3c; }
        #zona-central { border: 2px solid #f39c12; color: #f39c12; }

        .label-zona { font-size: 12px; font-weight: bold; color: white; margin: 0; }
        .info-mini { font-size: 10px; color: #bbb; margin: 2px 0; }

        /* LEDS */
        .contenedor-leds { display: flex; gap: 8px; margin-top: 4px; }
        .led {
            width: 18px; height: 18px; border: 2px solid white; border-radius: 4px;
        }
        .led-adaptada { border-radius: 50%; }
        .led-off { background-color: #2ecc71; box-shadow: 0 0 8px #2ecc71; } /* Libre */
        .led-on { background-color: #e74c3c; box-shadow: 0 0 8px #e74c3c; }   /* Ocupado */
        .led-error { background-color: #555; }

        /* DISE√ëO PANEL DERECHO */
        #info-panel {
            background: #252525; border-radius: 12px; padding: 20px;
            border-top: 10px solid #444; display: block; /* Siempre visible o activado por clic */
        }
        .panel-vacio { color: #888; font-style: italic; }
        h1 { font-size: 1.4em; margin-bottom: 20px; color: #3498db; }
        .stat-row { margin: 15px 0; padding-bottom: 10px; border-bottom: 1px solid #333; }
        .big-num { font-size: 1.8em; font-weight: bold; color: #2ecc71; }
    </style>
</head>
<body>

    <div class="main-layout">
        <div class="map-container">
            <img src="{{ url_for('static', filename='img/logo_parking.png') }}" class="map-image">

            <div id="zona-norte" class="zona-interactiva" style="top: 3%; left: 80%; width: 20%; height: 30%;" onclick="mostrarInfo('Zona Norte')">
                <p class="label-zona">NORTE</p>
                <p class="info-mini">PMR: 4 | STD: 41</p>
                <div class="contenedor-leds">
                    <div id="led-p2" class="led led-adaptada led-error"></div>
                    <div id="led-p3" class="led led-error"></div>
                </div>
            </div>
            
            <div id="zona-sur" class="zona-interactiva" style="top: 40%; left: 80%; width: 20%; height: 20%;" onclick="mostrarInfo('Zona Sur')">
                <p class="label-zona">SUR</p>
                <p class="info-mini">PMR: 2 | STD: 27</p>
                <div class="contenedor-leds">
                    <div id="led-p4" class="led led-adaptada led-error"></div>
                    <div id="led-p5" class="led led-error"></div>
                </div>
            </div>

            <div id="zona-central" class="zona-interactiva" style="top: 60%; left: 0%; width: 70%; height: 35%;" onclick="mostrarInfo('Zona Central')">
                <p class="label-zona" style="font-size: 18px;">CENTRAL</p>
                <p class="info-mini" style="font-size: 13px;">PMR: 9 | EST√ÅNDAR: 189</p>
                <div class="contenedor-leds">
                    <div id="led-p6" class="led led-adaptada led-error"></div>
                    <div id="led-p7" class="led led-error"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="side-panel">
        <h1>Ociopia Smart Parking</h1>
        <div id="info-panel">
            <div id="contenido-panel" class="panel-vacio">
                Selecciona un sector en el mapa para ver la disponibilidad en tiempo real.
            </div>
        </div>
        <p style="margin-top: auto; font-size: 0.8em; color: #666;">üîµ C√≠rculo = Adaptada (PMR)<br>üü¶ Cuadrado = Est√°ndar</p>
    </div>

    <script>
        const CONFIG = {
            "Zona Norte":   { normales: 41, adaptadas: 4, color: "#3498db" },
            "Zona Sur":     { normales: 27, adaptadas: 2, color: "#e74c3c" },
            "Zona Central": { normales: 189, adaptadas: 9, color: "#f39c12" }
        };

        let estadosPines = {};

        function mostrarInfo(nombreZona) {
            let nOcupadas = 0, aOcupadas = 0;
            if(nombreZona === "Zona Norte") { aOcupadas = estadosPines.p2 === 1 ? 1 : 0; nOcupadas = estadosPines.p3 === 1 ? 1 : 0; }
            else if(nombreZona === "Zona Sur") { aOcupadas = estadosPines.p4 === 1 ? 1 : 0; nOcupadas = estadosPines.p5 === 1 ? 1 : 0; }
            else { aOcupadas = estadosPines.p6 === 1 ? 1 : 0; nOcupadas = estadosPines.p7 === 1 ? 1 : 0; }

            const panel = document.getElementById('info-panel');
            const contenido = document.getElementById('contenido-panel');
            panel.style.borderTopColor = CONFIG[nombreZona].color;
            
            contenido.className = ""; // Quitar estilo vac√≠o
            contenido.innerHTML = `
                <h2 style="color:${CONFIG[nombreZona].color}; margin-top:0;">${nombreZona}</h2>
                <div class="stat-row">
                    <span style="color:#bbb">PLAZAS EST√ÅNDAR</span><br>
                    <span class="big-num">${CONFIG[nombreZona].normales - nOcupadas}</span> <small>/ ${CONFIG[nombreZona].normales}</small>
                </div>
                <div class="stat-row" style="border:none">
                    <span style="color:#3498db">PLAZAS PMR ‚ôø</span><br>
                    <span class="big-num" style="color:#3498db">${CONFIG[nombreZona].adaptadas - aOcupadas}</span> <small>/ ${CONFIG[nombreZona].adaptadas}</small>
                </div>
            `;
        }

        function actualizar() {
            fetch('/status').then(res => res.json()).then(data => {
                estadosPines = data;
                for (let i = 2; i <= 7; i++) {
                    const led = document.getElementById('led-p' + i);
                    if (!led) continue;
                    led.className = 'led ' + (led.classList.contains('led-adaptada') ? 'led-adaptada ' : '') + 
                        (data['p' + i] === 1 ? 'led-on' : (data['p' + i] === 0 ? 'led-off' : 'led-error'));
                }
            });
        }
        setInterval(actualizar, 2000);
        actualizar();
    </script>
</body>
</html>

